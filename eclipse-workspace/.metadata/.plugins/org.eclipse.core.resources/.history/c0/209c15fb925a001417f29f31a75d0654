package com.iparadigms.ipgrammar;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.FileWriter;
import java.io.PrintWriter;
import java.util.logging.Level;

public class CorpusText {
    
    private final String CORPUS_DIR = "grammar-webapp/src/com/iparadigms/ipgrammar/resources/";
    private final String TATOEBA_CORPUS_SUFFIX = "_tatoeba_corpus.txt";
    private final String TATOEBA_CORPUS_CSV = CORPUS_DIR + "sentences.csv";
    
    public CorpusText(){}
    
    public String getTatoebaCorpus (String langCode, boolean fileExists, int lineLimit) throws IOException{
        
        String extractedCorpusText = "";
        String corpusText = CORPUS_DIR + langCode + TATOEBA_CORPUS_SUFFIX;
        String line = null;
        int lineCount = 0;
        
        try {
            if(fileExists){
System.out.println("USING EXTRACTED CORPUS");
                //Read from extracted corpus and add lines to text until line limit reached
                BufferedReader extractedCorpusReader = new BufferedReader(new FileReader(corpusText));
                
                while ((line = extractedCorpusReader.readLine()) != null && lineCount < lineLimit){
                    extractedCorpusText += line + "\n";
                    lineCount++;
                }
                extractedCorpusReader.close();
            }
            else {
System.out.println("EXTRACTING CORPUS");
                //Extract text from corpus while also adding lines to text until line limit reached
                BufferedReader corpusReader = new BufferedReader(new FileReader(TATOEBA_CORPUS_CSV));
                FileWriter write = new FileWriter(corpusText, false);
                PrintWriter printLine = new PrintWriter(write);
                
                while ((line = corpusReader.readLine()) != null){
                    if(line.split("\t")[1].equals(langCode)){
                        line = line.split("\t")[2];
                        printLine.println(line);
                        
                        if (lineCount < lineLimit){
                            extractedCorpusText += line + "\n";
                            lineCount++;
                        }
                    }
                }
                corpusReader.close();
                printLine.close();
            }
        }
        catch(IOException ex) {
            System.out.println(ex.getMessage());
        }
        
        return extractedCorpusText;
    }
}